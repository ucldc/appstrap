---
-   hosts: localhost
    connection: local
    gather_facts: True         
    tasks:
    - name: check_appstrap
      shell: . $HOME/appstrap/setenv.sh
    - name: figure out the home directory
      shell: "getent passwd solr | cut -d: -f6"
      register: role_home_dir
    - name: put bashrc in place
      copy: src=./templates/solr/bashrc dest=~/.bashrc
    - name: create servers tomcat directory
      action: file path=~/servers/tomcat state=directory
    - name: copy tomcat CATALINA_BASE directories and files
      action: shell cp -rp ~/java/tomcat/* ~/servers/tomcat
    - name: create servers solr directory
      action: file path=~/servers/solr state=directory
    - name: create dc-collection solr core directory
      action: file path=~/servers/solr/dc-collection state=directory
    - name: copy solr.xml
      action: copy src=./templates/solr/solr/solr.xml dest=~/servers/solr
    - name: copy zoo.cfg
      action: copy src=./templates/solr/solr/zoo.cfg dest=~/servers/solr
    - name: copy example collection files to dc-collection
      action: shell cp -rp ~/java/solr/example/solr/collection1/* ~/servers/solr/dc-collection
    - name: copy dc-collection schema.xml into webapp
      action: copy src=./templates/solr/solr/dc-collection/conf/schema.xml dest=~/servers/solr/dc-collection/conf/
    - name: install solr to tomcat
      action: copy src=~/java/solr/dist/solr-4.3.1.war dest=~/servers/tomcat/webapps/solr.war #restart tomcat now, to unpack solr. then change WEB-INF/web.xml
#TODO: set CATALINA_BASE AND CATALINA_HOME
    - name: start tomcat to install solr war
      action: shell ~/java/tomcat/bin/startup.sh
    - name: stop tomcat
      action: shell ~/java/tomcat/bin/shutdown.sh
    - name: replace web.xml for solr webapp
      action: copy src=./templates/solr/solr/web.xml dest=~/servers/tomcat/webapps/solr/WEB-INF/web.xml
    - name: start tomcat
      action: shell ~/java/tomcat/bin/startup.sh
# to add  
##    <env-entry>
##       <env-entry-name>solr/home</env-entry-name>
##       <env-entry-value>/home/ec2-user/servers/solr</env-entry-value>
##       <env-entry-type>java.lang.String</env-entry-type>
##    </env-entry>
